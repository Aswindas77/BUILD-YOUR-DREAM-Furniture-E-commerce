<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>

	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link rel="shortcut icon" href="/public/userAssets/images/favicon.png">

	<meta name="author" content="CodePixar">

	<meta name="description" content="">

	<meta name="keywords" content="">

	<meta charset="UTF-8">

	<title>BUILD YOUR DREAM | Buy Modern Furniture Online</title>


	<link rel="stylesheet" href="/public/userAssets/css/linearicons.css">
	<link rel="stylesheet" href="/public/userAssets/css/font-awesome.min.css">
	<link rel="stylesheet" href="/public/userAssets/css/themify-icons.css">
	<link rel="stylesheet" href="/public/userAssets/css/bootstrap.css">
	<link rel="stylesheet" href="/public/userAssets/css/owl.carousel.css">
	<link rel="stylesheet" href="/public/userAssets/css/nice-select.css">
	<link rel="stylesheet" href="/public/userAssets/css/nouislider.min.css">
	<link rel="stylesheet" href="/public/userAssets/css/ion.rangeSlider.css" />
	<link rel="stylesheet" href="/public/userAssets/css/ion.rangeSlider.skinFlat.css" />
	<link rel="stylesheet" href="/public/userAssets/css/magnific-popup.css">
	<link rel="stylesheet" href="/public/userAssets/css/main.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
	<link href="css/font-awesome.css" rel="stylesheet">
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">


	<link rel="stylesheet" href="/public/userAssets/css/custom.css">


	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

	<link rel="stylesheet" href="/public/userAssets/css/custom.css">
	<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>  



	<link rel="stylesheet" href="/public/userAssets/css/shop.css">
</head>

<body id="category">

	<!-- Start Header Area -->
	<%- include("../partials/userPartial/userHeader") %>
		<!-- End Header Area -->

		<%- include('../partials/userPartial/breadcrumb', { pageTitle: 'shopping page' , currentPage: 'Shop' ,
			parentPage: null, parentPath: null }) %>

			<!-- Centered Container -->
			<div style="margin-top: 50px;" class="container-centered">
				<div class="container">
					<div class="row">



						<div class="col-xl-9 col-lg-8 col-md-7 mx-auto">

							<div class="top-bar">
								<div class="search-container">
									<input type="text" class="search-input" id="searchInput"
										placeholder="Search products..." value="<%= filters?.search || '' %>">
									<svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
										stroke="currentColor" stroke-width="2">
										<circle cx="11" cy="11" r="8"></circle>
										<line x1="21" y1="21" x2="16.65" y2="16.65"></line>
									</svg>
								</div>

								<select class="sort-select" id="sortSelect">
									<option value="">Sort By</option>
									<option value="nameAsc" <%=filters?.sort==='nameAsc' ? 'selected' : '' %>>Name (A-Z)
									</option>
									<option value="nameDesc" <%=filters?.sort==='nameDesc' ? 'selected' : '' %>>Name
										(Z-A)</option>
									<option value="priceAsc" <%=filters?.sort==='priceAsc' ? 'selected' : '' %>>Price:
										Low to High</option>
									<option value="priceDesc" <%=filters?.sort==='priceDesc' ? 'selected' : '' %>>Price:
										High to Low</option>
								</select>

								<select class="sort-select" id="categorySelect">
									<option value="">All Categories</option>
									<% categories.forEach(category=> { %>
										<option value="<%= category.name %>" <%=filters?.category===category.name
											? 'selected' : '' %>>
											<%= category.name %>
										</option>
										<% }) %>
								</select>
								<button id="applyFilters" class="filter-btn apply">
									<i class="fas fa-filter"></i> Apply Filters
								</button>
								<button id="resetFilters" class="filter-btn reset">
									<i class="fas fa-undo"></i> Reset
								</button>

							</div>



							<!-- Product Grid -->
							<div class="container">
								<div class="product-grid">
									<% products.forEach(product=> { %>
										<div class="product-card">
											<div class="product-badge">
												<% if (product.productOffer> 0) { %>
													<span class="badge badge-danger">SAVE <%= product.productOffer %>
															%</span>
													<% } %>
														<% if (product.isNew) { %>
															<span class="badge badge-primary">NEW ARRIVAL</span>
															<% } %>
																<% if (product.isBestSeller) { %>
																	<span class="badge badge-success">BESTSELLER</span>
																	<% } %>
											</div>

											<div class="product-image-wrap">
												<% if (product.images && product.images.length> 0) { %>
													<div class="product-image-slider">
														<% product.images.slice(0, 3).forEach(image=> { %>
															<img src="<%= image %>" alt="<%= product.name %>"
																class="product-image">
															<% }) %>
													</div>
													<% } else { %>
														<img src="/default-product.jpg" alt="<%= product.name %>"
															class="product-image">
														<% } %>

															<div class="product-hover-overlay">
																<button class="quick-view-btn"
																	onclick="quickView('<%= product._id %>')">
																	View Product</button>
															</div>
											</div>

											<div class="product-info">
												<div class="product-rating">
													<div class="stars">
														<% let rating=Number(product.ratings) || 0; %>
															<% for(let i=1; i <=5; i++) { %>
																<i class="fa fa-star<%= i <=rating? '': 'o' %>"></i>
																<% } %>
													</div>
													<span class="rating-count">(<%= product.ratings || 0 %>
															reviews)</span>
												</div>

												<h3 class="product-title">
													<a onclick="quickView('<%= product._id %>')">
														<%= product.name %>
													</a>
												</h3>

												<div class="product-price">
													<% if (product.productOffer> 0) { %>
														<span class="price-sale">₹<%= product.salesPrice.toFixed(2) %>
														</span>
														<span class="price-original">₹<%= (product.salesPrice / (1 -
																product.productOffer / 100)).toFixed(2) %></span>
														<% } else { %>
															<span class="price-sale">₹<%= product.salesPrice.toFixed(2)
																	%>
															</span>
															<% } %>
												</div>

												<% if(product.stock>0){ %>
													<button class="add-to-cart"
														onclick="addToCart('<%= product._id %>')">
														<i class="fa fa-shopping-cart me-2"></i>ADD TO CART
													</button>
													<% }else{ %>
														<button class="add-to-cart" onclick="">
															<i class="fa fa-shopping-cart me-2"></i>product unAvailable
														</button>
														<% } %>
											</div>

											<div class="product-actions">
												<button
													class="action-btn wishlist <% if (wishlistProducts.includes(product._id.toString())) { %> active <% } %>"
													onclick="addToWhishList('<%= product._id %>')"
													id="wishlist-btn-<%= product._id %>">

													<% if (wishlistProducts.includes(product._id.toString())) { %>
														<i class="fa fa-heart"></i>
														<% } else { %>
															<i class="fa fa-heart-o"></i>
															<% } %>
												</button>
											</div>

										</div>
										<% }); %>
								</div>
							</div>

						</div>
					</div>
				</div>

				<div class="pagination" style="margin-top: 57px; margin-left: 44%;">
					<% if (currentPage> 1) { %>
						<a href="#" class="page-link" data-page="<%= currentPage - 1 %>"
							style="text-decoration: none; padding: 5px 5px; width: 85px; border: 1px solid #ccc; margin-right: 5px;">Previous</a>
						<% } %>

							<% for (let i=1; i <=totalPages; i++) { %>
								<a href="#" class="page-link pagination-link <%= currentPage === i ? 'active' : '' %>"
									data-page="<%= i %>">
									<%= i %>
								</a>
								<% } %>


									<% if (currentPage < totalPages) { %>
										<a href="#" class="page-link" data-page="<%= currentPage + 1 %>"
											style="text-decoration: none; padding: 5px 10px; width: 80px; border: 1px solid #ccc; margin-left: 5px;">Next</a>
										<% } %>
				</div>

				<!-- Start related-product Area -->
				<section class="related-product-area section_gap">
					<div class="container">
						<div class="row justify-content-center">
							<div class="col-lg-6 text-center">
								<div class="section-title">
									<h1>Deals of the Week</h1>
									<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
										incididunt ut labore et dolore magna aliqua.</p>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-lg-9">
								<div class="row">
									<!-- Repeat for related products -->
								</div>
							</div>
							<div class="col-lg-3">
								<div class="ctg-right">
									<a href="#" target="_blank">
										<img class="img-fluid d-block mx-auto" src="img/category/c5.jpg" alt="">
									</a>
								</div>
							</div>
						</div>
					</div>
				</section>
				<!-- End related-product Area -->

				<!-- Start footer Area -->
				<%- include("../partials/userPartial/userFooter") %>
					<!-- End footer Area -->



					<!-- Scripts -->
					<script src="/public/userAssets/js/vendor/jquery-2.2.4.min.js"></script>
					<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
						integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
						crossorigin="anonymous"></script>
					<script src="/public/userAssets/js/vendor/bootstrap.min.js"></script>
					<script src="/public/userAssets/js/jquery.ajaxchimp.min.js"></script>
					<script src="/public/userAssets/js/jquery.nice-select.min.js"></script>
					<script src="/public/userAssets/js/jquery.sticky.js"></script>
					<script src="/public/userAssets/js/nouislider.min.js"></script>
					<script src="/public/userAssets/js/countdown.js"></script>
					<script src="/public/userAssets/js/jquery.magnific-popup.min.js"></script>
					<script src="/public/userAssets/js/owl.carousel.min.js"></script>
					<!--gmaps Js-->
					<script
						src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
					<script src="/public/userAssets/js/gmaps.min.js"></script>
					<script src="/public/userAssets/js/main.js"></script>
					<script>

						function quickView(productId) {
							window.location.href = `/user/product_view/${productId}`;
						}

						function addToCart(productId) {
							console.log(productId)
							fetch("/user/cart", {
								method: "POST",
								headers: {
									"Content-Type": "application/json"
								},
								body: JSON.stringify({
									productId,
									quantity: 1
								})
							})
								.then(response => response.json())
								.then(data => {
									if (data.message) {
										showToast(data.message);
									}
								})
								.catch(error => {
									showToast("Something went wrong.", "error");
								});
						}

						function showToast(message, type) {
							Toastify({
								text: message,
								duration: 3000,
								gravity: "top",
								position: "center",
								close: true,
								style: {
									background: "orange",
									color: "white",
									fontWeight: "bold",
									borderRadius: "8px",
								},
							}).showToast();
						}




						document.getElementById('filterModal').addEventListener('click', function (e) {
							if (e.target === this) {
								this.classList.remove('active');
							}
						});



						document.getElementById("searchBox").addEventListener("input", async function () {
							let query = this.value.trim();
							console.log("Search Query:", query);




							if (query.length > 0) {
								const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
								const products = await response.json();


								let productList = document.getElementById("productList");
								productList.innerHTML = "";

								products.forEach(product => {
									let item = `<div class="product-item">
							<h3>${product.name}</h3>
							<p>${product.price}</p>
						</div>`;
									productList.innerHTML += item;
								});
							}
						});

					</script>

					<script>

						document.addEventListener('DOMContentLoaded', function () {
							const searchInput = document.getElementById('searchInput');
							const sortSelect = document.getElementById('sortSelect');
							const categorySelect = document.getElementById('categorySelect');
							const applyButton = document.getElementById('applyFilters');
							const resetButton = document.getElementById('resetFilters');
							const productGrid = document.querySelector('.product-grid');

							let currentFilters = {
								search: '<%= filters?.search || "" %>',
								sort: '<%= filters?.sort || "" %>',
								category: '<%= filters?.category || "" %>',
								page: '<%= currentPage || 1 %>'
							};

							function updateProducts(filters) {
								const queryString = new URLSearchParams(filters).toString();

								// Show loading state
								productGrid.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin fa-3x"></i></div>';

								fetch(`/user/shop/filter?${queryString}`)
									.then(response => response.json())
									.then(data => {
										if (data.success) {

											window.history.pushState({}, '', `/user/shop?${queryString}`);

											// Update product grid and pagination
											displayProducts(data.products, data.wishlistProducts);
											updatePagination(data.currentPage, data.totalPages, filters);
										} else {
											throw new Error(data.message || 'Failed to filter products');
										}
									})
									.catch(error => {
										console.error('Filter error:', error);
										showToast('Error applying filters', 'error');
									});
							}

							function updatePagination(currentPage, totalPages) {
    const paginationContainer = document.querySelector('.pagination');
    if (!paginationContainer) return;

    let paginationHTML = '';

    // Previous button
    if (currentPage > 1) {
        paginationHTML += `<a href="#" class="page-link" data-page="${currentPage - 1}">Previous</a>`;
    }

    // Page numbers
    for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `<a href="#" class="page-link ${currentPage === i ? 'active' : ''}" data-page="${i}">${i}</a>`;
    }

    // Next button
    if (currentPage < totalPages) {
        paginationHTML += `<a href="#" class="page-link" data-page="${currentPage + 1}">Next</a>`;
    }

    paginationContainer.innerHTML = paginationHTML;
}


							
							
							function fetchFilteredProducts(page = 1) {
								const search = document.getElementById('search-input')?.value || "";
								const category = document.getElementById('category-filter')?.value || "";
								const minPrice = document.getElementById('min-price')?.value || "";
								const maxPrice = document.getElementById('max-price')?.value || "";
								const sort = document.getElementById('sort-filter')?.value || "";

								fetch(`/api/products?search=${search}&category=${category}&minPrice=${minPrice}&maxPrice=${maxPrice}&sort=${sort}&page=${page}`)
									.then(response => response.json())
									.then(data => {
										displayProducts(data.products, data.wishlistProducts, data.totalPages, data.currentPage);
									})
									.catch(error => console.error("Error fetching products:", error));
							}

							applyButton.addEventListener('click', function () {
								currentFilters = {
									search: searchInput.value,
									sort: sortSelect.value,
									category: categorySelect.value,
									page: 1
								};
								updateProducts(currentFilters);
							});

							resetButton.addEventListener('click', function () {
								searchInput.value = '';
								sortSelect.value = '';
								categorySelect.value = '';
								currentFilters = {
									search: '',
									sort: '',
									category: '',
									page: 1
								};
								updateProducts(currentFilters);
							});

							document.querySelectorAll('.page-link').forEach(link => {
								link.addEventListener('click', function (e) {
									e.preventDefault();
									const newPage = parseInt(this.dataset.page);
									currentFilters.page = newPage;
									updateProducts(currentFilters);
								});
							});
						});


						function displayProducts(products, wishlistProducts, totalPages, currentPage) {
							const productGrid = document.querySelector('.product-grid');
							const paginationContainer = document.querySelector('.pagination');

							if (!productGrid) {
								console.error('Product grid container not found');
								return;
							}

							if (!products || products.length === 0) {
								productGrid.innerHTML = ` 
								<div class="text-center">
									<h3>No products found</h3>
									<p>Try adjusting your filters</p>
								</div>
							`;
								return;
							}

							productGrid.innerHTML = products.map(product => `
        <div class="product-card">
            <div class="product-badge">
                ${product.productOffer > 0 ? `<span class="badge badge-danger">SAVE ${product.productOffer}%</span>` : ''}
                ${product.isNew ? '<span class="badge badge-primary">NEW ARRIVAL</span>' : ''}
                ${product.isBestSeller ? '<span class="badge badge-success">BESTSELLER</span>' : ''}
            </div>

            <div class="product-image-wrap">
                ${product.images && product.images.length > 0 ? `
                    <div class="product-image-slider">
                        ${product.images.slice(0, 3).map(image => `<img src="${image}" alt="${product.name}" class="product-image">`).join('')}
                    </div>
                ` : `<img src="/default-product.jpg" alt="${product.name}" class="product-image">`}
                
                <div class="product-hover-overlay">
                    <button class="quick-view-btn" onclick="quickView('${product._id}')">View Product</button>
                </div>
            </div>

            <div class="product-info">
                <h3 class="product-title"><a onclick="quickView('${product._id}')">${product.name}</a></h3>
                <div class="product-price">₹${product.salesPrice.toFixed(2)}</div>
                <button class="add-to-cart" onclick="addToCart('${product._id}')">
                    <i class="fa fa-shopping-cart me-2"></i>ADD TO CART
                </button>
            </div>
            <div class="product-actions">
                <button class="action-btn wishlist ${wishlistProducts.includes(product._id.toString()) ? 'active' : ''}" 
                    onclick="addToWhishList('${product._id}')" 
                    id="wishlist-btn-${product._id}">
                    ${wishlistProducts.includes(product._id.toString()) ? `<i class="fa fa-heart"></i>` : `<i class="fa fa-heart-o"></i>`}
                </button>
            </div>
        </div>
    `).join('');

							updatePagination(totalPages, currentPage);
						}


					</script>

					<script>


						function addToWhishList(productId) {

							let button = document.getElementById(`wishlist-btn-${productId}`);
							let icon = button.querySelector("i");


							fetch(`/user/whishList`, {
								method: "POST",
								headers: {
									"Content-Type": "application/json"
								},
								body: JSON.stringify({ productId })
							})
								.then(response => response.json())
								.then(data => {
									if (data.success) {

										showToast(data.message);

										button.classList.toggle("active");

										if (icon.classList.contains('fa-heart-o')) {
											icon.classList.remove('fa-heart-o');
											icon.classList.add('fa-heart');
										} else {
											icon.classList.remove('fa-heart');
											icon.classList.add('fa-heart-o');
										}
									} else {
										showToast(data.message);
									}

								})
								.catch(error => {
									console.error('Error adding to wishlist:', error);
								});

						}




					</script>
</body>

</html>