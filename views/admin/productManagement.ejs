<h1>Product Management</h1>

<!-- Add Product Form -->

<a href="/admin/addProduct"><button type="submit">Add Product</button></a>
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">


<!-- Product Table -->
<table style="margin-top: 10px;" id="productTable" class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>#</th>
      <th>Product Name</th>
      <!-- <th>Description</th> -->
      <th>Category</th>
      <th>Sales Price</th>
      <th>Product Offer (%)</th>
      <th>Stock</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <% products.forEach((product, index)=> { %>
      <tr>

        <td>
          <%= index + 1 %>
        </td>
        <td><a href=/admin/productView/<%=product._id%>><%= product.name %></a></td>
        <td>
          <%= product.category ? product.category.name : "No Category Assigned" %>
        </td>
        <!-- <td>product.description</td> -->
        <td>â‚¹<%= product.salesPrice.toFixed(2) %>
        </td>
        <td>
          <%= product.productOffer %>
        </td>
        <td>
          <%= product.stock %>
        </td>
        <td>
          <span class="badge <%= product.status === 'active' ? 'bg-success' : 'bg-danger' %>">
            <%= product.status %>
          </span>
        </td>
        <td>
          <!-- Add Action Buttons -->
          <button class="btn btn-primary btn-sm" onclick="editProduct('<%= product._id %>')">Edit</button>
          <button id="deleteBtn <%= product._id %>" class="btn btn-danger btn-sm"
            onclick="deleteProduct('<%= product._id %>')">Delete</button>
        </td>
      </tr>
      <% }) %>
  </tbody>
</table>
<script>
  function deleteProduct(productId) {
  Swal.fire({
    title: 'Are you sure?',
    text: "You won't be able to revert this!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, delete it!'
  }).then((result) => {
    if (result.isConfirmed) {
      fetch(`/admin/deleteProduct/${productId}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
        },
      })
      .then(response => response.json())
      .then(data => {
        console.log(data.message);

        if (data.message === "Product successfully marked as deleted.") {
          Swal.fire({
            title: 'Deleted!',
            text: 'Product has been deleted successfully.',
            icon: 'success',
            timer: 1500
          }).then(() => {
            window.location.href = 'http://localhost:3000/admin/productManagement';
          });
        } else {
          Swal.fire({
            title: 'Error!',
            text: 'Failed to delete product',
            icon: 'error',
          });
        }
      })
      .catch(error => {
        console.error('Error:', error);
        Swal.fire({
          title: 'Error!',
          text: 'Something went wrong',
          icon: 'error',
        });
      });
    }
  });
}
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>